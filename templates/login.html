<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8" />
    <!-- You can use Open Graph tags to customize link previews.
    Learn more: https://developers.facebook.com/docs/sharing/webmasters -->
    <meta property="fb:app_id" content="2024489881171070" /> 
    <meta property="og:url" content="http://www.commit.vote" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="COMM!T" />
    <meta property="og:description" content="Feeling over-connected and under-committed? COMM!T let's friends help friends follow through" />
    <meta property="og:image" content="https://commitweb.herokuapp.com/static/img/fbimg.jpg" />

    <link rel="icon" type="image/png" href="../static/now/assets/img/favicon.png">

    <link rel="apple-touch-icon" sizes="76x76" href="../static/now/assets/img/apple-icon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>COMM!T</title>
    <meta content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700,200" rel="stylesheet" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css" />
    <!-- CSS Files -->
    <link href="../static/now/assets/css/bootstrap.min.css" rel="stylesheet" />
    <link href="../static/now/assets/css/now-ui-kit.css?v=1.1.0" rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="../static/now/assets/css/demo.css" rel="stylesheet" />
    
    <style>
      @media screen and (max-width: 576px) {
        .footer nav {
          width: 100%;
          text-align: center;
        }
        .footer.copyright {
          width: 100%;
          text-align: center;
        }
        .footer {
          padding: 2% 0;
        }
      }

      .footer.copyright {
        text-align: right;
      }

      .page-header[filter-color="redblue"] {
        background: rgba(44, 44, 44, 0.2);
        background: -webkit-linear-gradient(90deg, rgba(44, 44, 44, 0.2), rgba(224, 23, 3, 0.6));
        background: -o-linear-gradient(90deg, rgba(44, 44, 44, 0.2), rgba(224, 23, 3, 0.6));
        background: -moz-linear-gradient(90deg, rgba(44, 44, 44, 0.2), rgba(224, 23, 3, 0.6));
        background: linear-gradient(0deg, rgba(255, 50, 100, 0.8), rgba(10, 50, 255, 0.8));
      }

      .page-header[filter-color="orange"] {
        background: rgba(44, 44, 44, 0.2);
        background: -webkit-linear-gradient(90deg, rgba(44, 44, 44, 0.2), rgba(224, 23, 3, 0.6));
        background: -o-linear-gradient(90deg, rgba(44, 44, 44, 0.2), rgba(224, 23, 3, 0.6));
        background: -moz-linear-gradient(90deg, rgba(44, 44, 44, 0.2), rgba(224, 23, 3, 0.6));
        background: linear-gradient(15deg, rgba(4, 24, 234, 0.2), rgba(224, 23, 3, 0.7));
      }

      .form-control {
        background-color: rgba(255, 255, 255, 0.3);
      }

      .input-group-focus input {
        background-color: rgba(255, 255, 255, 0.3);
      }
    </style>
  </head>


  <body class="login-page sidebar-collapse" style="height:100%">
    <script src="{{ url_for('static', filename='js/fblogin.js') }}"></script>
    <!-- <script src="https://apis.google.com/js/platform.js" async defer></script>
    <script src="{{ url_for('static', filename='js/glogin.js') }}"></script> -->


    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg bg-primary fixed-top navbar-transparent " color-on-scroll="400">
      <div class="container">
        <div class="navbar-translate">
          <a class="navbar-brand" href="#" rel="tooltip" title="Designed and coded by Jared and Jim" data-placement="bottom" target="_blank">
                    COMM!T
                </a>
          <button class="navbar-toggler navbar-toggler" type="button" data-toggle="collapse" data-target="#navigation" aria-controls="navigation-index" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-bar bar1"></span>
                    <span class="navbar-toggler-bar bar2"></span>
                    <span class="navbar-toggler-bar bar3"></span>
                </button>
        </div>
        <!-- <div class="collapse navbar-collapse justify-content-end" id="navigation" data-nav-image="../static/now/assets/img/blurred-image-1.jpg"> -->
        <div class="collapse navbar-collapse justify-content-end" id="navigation" data-nav-image="../static/img/selmaskyblur.jpg">
          <ul class="navbar-nav">
            <!-- <li class="nav-item">
                        <a class="nav-link" href="#">Back to COMM!T</a>
                    </li> -->
            <li class="nav-item">
              <a class="nav-link" href="mailto:teamcommitapp@gmail.com">Have an issue?</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- End Navbar -->

    <div class="page-header" filter-color="orange" style="min-height:650px">
      <div class="page-header-image" style="background-image:url(../static/img/selmasky.jpg);background-position: 30% bottom;"></div>
      <div class="container">
        <div class="col-md-4 content-center" style="margin-top:20px">
          <div class="card card-login card-plain">
            <form class="form" method="" action="" >
              <div class="header text-center">
                <h1 class="title title-up">COMM!T</h1>
                <h2>Vote in Your Upcoming Primary</h2>
                <h5>{{refname}} has invited you to COMM!T. How should we remind you to check in?</h5>
                <div class="social-line" style="margin-bottom:20px">

                  <!-- <a href="#pablo" style="opacity: 0.9;margin:0 7px;" class="btn btn-neutral btn-twitter btn-icon btn-lg btn-round">
                                    <i class="fa fa-twitter"></i>
                                </a>

                  <a href="#pablo" style="opacity: 0.9;margin:0 7px;" class="btn btn-neutral btn-google btn-icon btn-lg btn-round">

                                    <i class="fa fa-google-plus"></i>
                                </a> -->
                  <a href="#" style="opacity: 0.9;margin:0 7px;" class="btn btn-neutral btn-facebook btn-icon btn-lg btn-round" onclick="fbLogin({{refcode}})">
                      <i class="fa fa-facebook-square"></i>
                  </a>
                </div>
              </div>
              <div class="content">
                <div style="margin-bottom: 20px">
                  <h6>
                    <a href="#" style="font-size: 1.0rem" data-toggle="modal" data-target="#expModal" class="link">How does this work?</a>
                  </h6>
                  <h6>
                    <a href="#" style="font-size: 1.0rem; font-weight:400; text-transform: none" data-toggle="modal" data-target="#nonvoterModal" class="link">I'm not eligible, can I help?</a>
                  </h6>
                </div>

                <div id="smsparent" class="input-group form-group-no-border input-lg">
                  <span class="input-group-addon" id="smsspan" style="background-color: rgba(255,255,255,0.2);">
                                    <i class="now-ui-icons ui-1_bell-53" ></i>
                                </span>
                  <input type="text" id="sms" class="form-control" style="background-color: rgba(255,255,255,0.2);" placeholder="SMS...">
                </div>

                <div id="emailparent" class="input-group form-group-no-border input-lg">
                  <span class="input-group-addon" id="emailspan" style="background-color: rgba(255,255,255,0.2);">
                                    <i class="now-ui-icons ui-1_email-85" ></i>
                                </span>
                  <input type="text" id="email" class="form-control" style="background-color: rgba(255,255,255,0.2)" placeholder="EMAIL...">
                </div>
                
                

                <!-- Bring Back with Javascript -->
                <div id="nameparent" class="input-group form-group-no-border input-lg" style="display:none">
                  <span class="input-group-addon" id="emailnamespan" style="background-color: rgba(255,255,255,0.2);border-left: 1px solid red;border-top: 1px solid red;border-bottom: 1px solid red;">
                                        <i class="now-ui-icons text_caps-small"></i>
                                    </span>
                  <input type="text" id="emailname" name="emailname" style="background-color: rgba(255,255,255,0.2);border-right: 1px solid red;border-top: 1px solid red;border-bottom: 1px solid red;" placeholder="Name..." class="form-control" />
                </div>
                <!-- Bring Back with Javascript -->
                <!-- <div id="smsnameparent" class="input-group form-group-no-border input-lg" style="display:none">
                  <span class="input-group-addon" id="smsnamespan" style="background-color: rgba(255,255,255,0.2);">
                                    <i class="now-ui-icons text_caps-small"></i>
                                </span>
                  <input type="text" id="smsname" name="smsname" style="background-color: rgba(255,255,255,0.2);" placeholder="Name..." class="form-control" />
                </div> -->
                <div class="input-group form-group-no-border input-lg" id="submit" style="display:none">
                  <a class="btn btn-primary btn-round" onclick="postUser()" style="width: 320px;height: 46px;opacity: 0.9;text-align: center; font-size:12px;padding-top:15px">
                    <i class="now-ui-icons" style></i>SUBMIT&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  </a>
                  <!-- <a class="btn btn-primary btn-round" onclick="postUser()" style="width: 320px;height: 46px;opacity: 0.9;text-align: left; font-size:12px;padding-top:15px">
                  <i class="now-ui-icons business_badge"></i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DEBUG PASSTHROUGH LOGIN...
                  </a> -->
                </div>

              </div>
              <!-- <div class="footer text-center">
                            <a href="#pablo" class="btn btn-primary btn-round btn-lg btn-block">Get Started</a>
                        </div> -->
              <!-- <div class="pull-left">
                            <h6>
                                <a href="#pablo" class="link">Create Account</a>
                            </h6>
                        </div> -->
              <!-- <div class="pull-right">
                <h6>
                    <a href="mailto:teamcommitapp@gmail.com" class="link">Need Help?</a>
                </h6>
              </div> -->
            </form>
          </div>



        </div>



      </div>

      <footer class="footer">
        <div class="container">
          <nav>
            <ul>
              <li>
                <a href="http://viral.media.mit.edu/">
                                MIT Media Lab
                            </a>
              </li>
              <li>
                <a href="http://gsd.harvard.edu/">
                                Harvard GSD
                            </a>
              </li>
              <li>
              </li>
            </ul>
          </nav>
          <div class="copyright">
            &copy;
            <script>
              document.write(new Date().getFullYear())
            </script><!-- , Designed and Coded by
            <a href="http://www.jared-johnson.com" target="_blank">Jared</a> and
            <a href="https://www.jamesdavidmoffet.com" target="_blank">Jim</a>. -->
          </div>
        </div>
      </footer>
    </div>

    <!-- Start Modal -->
        <div class="modal fade" id="expModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header justify-content-center" style="padding: 60px 24px 0 24px;">
                        <button type="button" class="close" data-dismiss="modal" data-toggle="modal"  aria-hidden="true" >
                            <i class="now-ui-icons ui-1_simple-remove"></i>
                        </button>
                        <h5 style="text-align:left;width:100%">We tell {{refname}} if you checked in at the polls</h5>
                    </div>
                    <div class="modal-body" style="padding-top:0;padding-bottom:0;">
                        <p style="font-size: 0.8rem; margin:0;">
                            <b>Your vote matters</b> more than you might think. <b>Local elections are often won by tens of votes</b> and local decisions directly impact you. Tomorrow, we'll send you a check-in link that will confirm your location, plus a few reminders. If you don't check in near a polling place, we'll send a simple message to {{refname}} that says you didn't check in. You can customize the messages that will be sent when you check in (or don't) using the "customize messages" link after you sign in. We'll have check in options for <b>absentee and non-eligible voters</b>. You'll also get to see how many folks you got to COMM!T. We keep all contact info confidential. Now, go for it!
                            <br>
                            <br>
                            -Team COMM!T
                        </p>
                    </div>
                    <div class="modal-footer">
                        <div style="float:left;line-height:30px;"></div>
                        <button href="#" data-toggle="modal" onclick="nonVoter()" class="btn btn-link btn-primary " style="text-align: center;font-size: 0.9rem">I'm ineligible to vote!</button>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Modal -->
        <!-- Start Modal -->
        <div class="modal fade" id="nonvoterModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header justify-content-center" style="padding: 60px 24px 0 24px;">
                        <button type="button" class="close" data-dismiss="modal" data-toggle="modal"  aria-hidden="true" >
                            <i class="now-ui-icons ui-1_simple-remove"></i>
                        </button>
                        <h5 style="text-align:left;width:100%">Help others COMM!T to vote!</h5>
                    </div>
                    <div class="modal-body" style="padding-top:0;">
                        <p style="font-size: 0.8rem;">
                            Just sign in as normal and the check-in reminder we send tomorrow will have a special link for you that will tell {{refname}} how many people you got to COMM!T. On behalf of America, Team COMM!T thanks you for your generosity :)
                            <br>
                            <br>
                            -Team COMM!T
                        </p>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Modal -->


    <script>
      function nonVoter() {
        $('#expModal').modal('hide')
        $('#nonvoterModal').modal('show')
      }


      var name = '';
      var email = '';
      var phone = '';
      var fbId = '';
      var twId = '';
      var fbToken = '';
      var twToken = '';
      var referringUser = 0;
      referringUser = {{refcode}};
      const mailformat = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
      const phone10 = /^\(?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;
      const phone11 = /^\(?([0-9]{1})[-. ]?([0-9]{3})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/;
      var namevalid = false;
      // var smsnamevalid = false;
      var emailvalid = false;
      var smsvalid = false;

      String.prototype.trim = function() {
        return this.replace(/^\s+|\s+$/g,"");
      }

      // document.getElementById("email")
      //   .addEventListener("keyup", function(event) {
      //     event.preventDefault();
      //     document.querySelector("#smsparent").setAttribute('style', 'display: none;');
      //     }
      //   );
      // document.getElementById("sms")
      //   .addEventListener("keyup", function(event) {
      //     event.preventDefault();
      //     document.querySelector("#emailparent").setAttribute('style', 'display: none;');
      //     }
      //   );

      document.getElementById("email")
        .addEventListener("keyup", function(event) {
          event.preventDefault();
          email = document.getElementById("email").value;

          if (email === "") {
            document.querySelector("#smsparent").setAttribute('style', 'display: flex;');
          } else {
            document.querySelector("#smsparent").setAttribute('style', 'display: none;');
            document.querySelector("#nameparent").setAttribute('style', 'display: flex;');
          }

          document.getElementById("emailspan").setAttribute("style", "border-left: 1px solid red;border-top: 1px solid red;border-bottom: 1px solid red;");
          document.getElementById("email").setAttribute("style", "border-right: 1px solid red;border-top: 1px solid red;border-bottom: 1px solid red;");
          var emailvalid = false;

          if (email.match(mailformat)) {
            document.getElementById("emailspan").setAttribute("style", "border-left: 1px solid green;border-top: 1px solid green;border-bottom: 1px solid green;");
            document.getElementById("email").setAttribute("style", "border-right: 1px solid green;border-top: 1px solid green;border-bottom: 1px solid green;");
            document.getElementById("nameparent").setAttribute("style", "display: flex;");
            var emailvalid = true;
            if (namevalid === true && emailvalid === true){
              document.getElementById("submit").setAttribute("style", "display: flex;");
            }
          } else {
            document.getElementById("submit").setAttribute("style", "display: none;");
          }
          
          
          if (event.keyCode === 13 && email.match(mailformat)) {
            
            console.log('triggered on enter key');
            email = document.getElementById("email").value;
            // this.value??
            document.getElementById("nameparent").setAttribute("style", "display: flex;");
            document.querySelector("[name='emailname']").focus();
          }
        });

      document.getElementById("sms")
        .addEventListener("keyup", function(event) {
          event.preventDefault();
          phone = document.getElementById("sms").value;

          if (phone === "") {
            document.querySelector("#emailparent").setAttribute('style', 'display: flex;');
          } else {
            document.querySelector("#emailparent").setAttribute('style', 'display: none;');
            document.querySelector("#nameparent").setAttribute('style', 'display: none;');
          }

          document.getElementById("smsspan").setAttribute("style", "border-left: 1px solid red;border-top: 1px solid red;border-bottom: 1px solid red;");
          document.getElementById("sms").setAttribute("style", "border-right: 1px solid red;border-top: 1px solid red;border-bottom: 1px solid red;");
          var smsvalid = false;

          if (phone.match(phone10) || phone.match(phone11)) {
            document.getElementById("smsspan").setAttribute("style", "border-left: 1px solid green;border-top: 1px solid green;border-bottom: 1px solid green;");
            document.getElementById("sms").setAttribute("style", "border-right: 1px solid green;border-top: 1px solid green;border-bottom: 1px solid green;");
            document.getElementById("nameparent").setAttribute("style", "display: flex;");
            var smsvalid = true;
            if (namevalid === true && smsvalid === true){
              document.getElementById("submit").setAttribute("style", "display: flex;");
            }
          } else {
            document.getElementById("submit").setAttribute("style", "display: none;");
          }

          if (event.keyCode === 13 && phone.match(phone10) || phone.match(phone11)) {
            phone = document.getElementById("sms").value;
            console.log('triggered on enter key');
            document.getElementById("nameparent").setAttribute("style", "display: flex;");
            document.querySelector("[name='emailname']").focus();
          }
        });

      document.getElementById("emailname")
        .addEventListener("keyup", function(event) {
          event.preventDefault();
          email = document.getElementById("email").value;
          name = document.querySelector("#emailname").value;

          if (name === "") {
            namevalid = false;
            document.getElementById("submit").setAttribute("style", "display: none;");
            document.getElementById("emailnamespan").setAttribute("style", "border-left: 1px solid red;border-top: 1px solid red;border-bottom: 1px solid red;");
            document.getElementById("emailname").setAttribute("style", "border-right: 1px solid red;border-top: 1px solid red;border-bottom: 1px solid red;");
            console.log('kill submit')
            console.log(namevalid)
          } else {
            namevalid = true;
            console.log(namevalid)
            document.getElementById("submit").setAttribute("style", "display: flex;");
            document.getElementById("emailnamespan").setAttribute("style", "border-left: 1px solid green;border-top: 1px solid green;border-bottom: 1px solid green;");
            document.getElementById("emailname").setAttribute("style", "border-right: 1px solid green;border-top: 1px solid green;border-bottom: 1px solid green;");
          }

          
          if (event.keyCode === 13 && name !== '' && email.match(mailformat)) {
            document.getElementById("submit").setAttribute("style", "display: flex;");
            name = document.getElementById("emailname").value;
            console.log('triggered on enter key');
            postUser();
          } else if (event.keyCode === 13 && name !== '' && namevalid && phone.match(phone10) || phone.match(phone11)) {
            document.getElementById("submit").setAttribute("style", "display: flex;");
            name = document.getElementById("emailname").value;
            console.log('triggered on enter key');
            postUser();
          }

        });

      // document.getElementById("smsname")
      //   .addEventListener("keyup", function(event) {
      //     event.preventDefault();
      //     phone = document.getElementById("sms").value;
      //     name = document.querySelector("#emailname").value;

      //     if (name === "") {
      //       namevalid = false;
      //       document.getElementById("submit").setAttribute("style", "display: none;");
      //       document.getElementById("emailnamespan").setAttribute("style", "border-left: 1px solid red;border-top: 1px solid red;border-bottom: 1px solid red;");
      //       document.getElementById("emailname").setAttribute("style", "border-right: 1px solid red;border-top: 1px solid red;border-bottom: 1px solid red;");
      //       console.log('kill submit')
      //       console.log(namevalid)
      //     } else {
      //       namevalid = true;
      //       console.log(namevalid)
      //       document.getElementById("submit").setAttribute("style", "display: flex;");
      //       document.getElementById("emailnamespan").setAttribute("style", "border-left: 1px solid green;border-top: 1px solid green;border-bottom: 1px solid green;");
      //       document.getElementById("emailname").setAttribute("style", "border-right: 1px solid green;border-top: 1px solid green;border-bottom: 1px solid green;");
      //     }

      //     if (event.keyCode === 13 && name !== '' && phone.match(phone10) || phone.match(phone11) && smsvalid === true) {
      //       document.getElementById("submit").setAttribute("style", "display: flex;");
      //       name = document.getElementById("emailname").value;
      //       console.log('triggered on enter key');
      //       postUser();
      //     }
      //   });

      // document.getElementById("emailname")
      //   .addEventListener("keyup", function(event) {
      //     event.preventDefault();
      //     document.getElementById("submit").setAttribute("style", "display: flex;");
      //   });
      // document.getElementById("smsname")
      //   .addEventListener("keyup", function(event) {
      //     event.preventDefault();
      //     document.getElementById("submit").setAttribute("style", "display: flex;");
      //   });

      let userId = 'steven';

      function postUser() {
        $.ajax({
          url: '/createuser',
          data: JSON.stringify({
            "name": name,
            "email": email,
            "phone": phone,
            "fbId": fbId,
            "twId": twId,
            "fbToken": fbToken,
            "twToken": twToken,
            "referringUser": referringUser
          }),
          dataType: 'json',
          contentType: "application/json",
          type: 'POST',
          success: function(response) {
            console.log(response);
            userId = response;
            emailUser(userId)
            window.location = "/commit/{{refcode}}A" + userId;
          },
          error: function(error) {
            console.log(error);
          }
        });
        console.log(`${userId} printed from ajax call`);
      }
      function emailUser(userId) {
        $.ajax({
          url: '/mail',
          data: JSON.stringify({
            "user": userId
          }),
          dataType: 'json',
          contentType: "application/json",
          type: 'POST',
          success: function(response) {
            console.log(response);
          },
          error: function(error) {
            console.log(error);
          }
        });
      }
    </script>
  </body>
  <!--   Core JS Files   -->
  <script src="../static/now/assets/js/core/jquery.3.2.1.min.js" type="text/javascript"></script>
  <script src="../static/now/assets/js/core/popper.min.js" type="text/javascript"></script>
  <script src="../static/now/assets/js/core/bootstrap.min.js" type="text/javascript"></script>
  <!--  Plugin for Switches, full documentation here: http://www.jque.re/plugins/version3/bootstrap.switch/ -->
  <script src="../static/now/assets/js/plugins/bootstrap-switch.js"></script>
  <!--  Plugin for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
  <script src="../static/now/assets/js/plugins/nouislider.min.js" type="text/javascript"></script>
  <!--  Plugin for the DatePicker, full documentation here: https://github.com/uxsolutions/bootstrap-datepicker -->
  <script src="../static/now/assets/js/plugins/bootstrap-datepicker.js" type="text/javascript"></script>
  <!-- Control Center for Now Ui Kit: parallax effects, scripts for the example pages etc -->
  <script src="../static/now/assets/js/now-ui-kit.js?v=1.1.0" type="text/javascript"></script>

</html>
